<?php

use Drupal\Core\Form\FormStateInterface;
use Symfony\Component\HttpFoundation\RedirectResponse;
use Drupal\Core\Url;

/**
 * Implements hook_form_FORM_ID_alter().
 * Target the Submission add/edit form specifically.
 */
function sl_submission_redirect_form_node_submission_form_alter(array &$form, FormStateInterface $form_state, $form_id) {
  // Attach our handler to the SUBMIT BUTTON so it runs after core's save().
  if (isset($form['actions']['submit']['#submit'])) {
    $form['actions']['submit']['#submit'][] = 'sl_submission_redirect_after_submit';
  }
  else {
    // Fallback: ensure #submit exists.
    $form['actions']['submit']['#submit'] = ['sl_submission_redirect_after_submit'];
  }
}

/**
 * Final submit: force redirect to /community-picks.
 */
function sl_submission_redirect_after_submit(array $form, FormStateInterface $form_state) {
  // Only on successful save of a Submission node.
  $entity = $form_state->getFormObject()->getEntity();
  if ($entity && $entity->getEntityTypeId() === 'node' && $entity->bundle() === 'submission') {
    // If you only want this when the node is published, uncomment:
    // if (!$entity->isPublished()) { return; }

    // Use a direct response so nothing can override it.
    $url = Url::fromUserInput('/community-picks')->toString();
    $form_state->setResponse(new RedirectResponse($url));
  }
}
